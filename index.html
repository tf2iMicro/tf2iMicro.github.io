<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <title>iMicro's Mancave</title>
        <link rel="stylesheet" href="styles.css" />
    </head>

    <body>
        <br />
        <a
            id="login-link"
            href="https://discord.com/api/oauth2/authorize?client_id=792132143483715654&redirect_uri=http%3A%2F%2Flocalhost%3A3000&response_type=code&scope=identify"
            >Login with Discord</a
        ><br /><br />
        <p id="welcome_txt"></p>

        <script>
            window.onload = function () {
                if (location.href.indexOf('code') !== -1) {
                    const code = location.href.substring(location.href.indexOf('code') + 5, location.href.length);
                    const req = new XMLHttpRequest();

                    req.open('POST', 'http://localhost:3000/user');
                    req.send(code);
                    req.onload = () => {
                        if (req.status === 500) {
                            document.getElementById(
                                'welcome_txt'
                            ).innerText = `There was an error with that. Please try logging in again. Error Code: ${req.status}`;
                        } else if (req.status === 200) {
                            document.getElementById('welcome_txt').innerText = `Welcome, ${req.responseText}!`;
                        } else {
                            document.getElementById(
                                'welcome_txt'
                            ).innerText = `An error occured. Please try logging in again. Error Code: ${req.status}`;
                        }
                    };
                }
            };
        </script>
    </body>
</html>
